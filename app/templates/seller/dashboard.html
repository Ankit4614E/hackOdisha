{% extends "base.html" %}

{% block content %}
    <h1>Seller Dashboard</h1>
    <h2>Available Products</h2>
    <ul>
        {% for product in products %}
            <li>{{ product.name }} - ${{ product.price }}</li>
        {% endfor %}
    </ul>

    <div id="order-notifications"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <script>
        var socket = io('/seller');
        
        socket.on('new_order', function(data) {
            var notification = document.createElement('div');
            notification.innerHTML = `
                <p>New order for ${data.product_name}</p>
                <button onclick="acceptOrder(${data.order_id})">Accept</button>
            `;
            document.getElementById('order-notifications').appendChild(notification);
            
            // Remove notification after 30 seconds
            setTimeout(() => {
                notification.remove();
            }, 30000);
        });
        
        socket.on('order_accepted', function(data) {
            if (data.seller_id !== {{ current_user.id }}) {
                var notifications = document.getElementById('order-notifications').children;
                for (var i = 0; i < notifications.length; i++) {
                    if (notifications[i].querySelector('button').getAttribute('onclick').includes(data.order_id)) {
                        notifications[i].remove();
                        break;
                    }
                }
            }
        });
        
        function acceptOrder(orderId) {
            socket.emit('accept_order', {order_id: orderId, seller_id: {{ current_user.id }}}, function(response) {
                if (response.success) {
                    alert('Order accepted successfully!');
                } else {
                    alert('Failed to accept order: ' + response.message);
                }
            });
        }
    </script>
{% endblock %}
